// ============================================================
// custom_event.js -- https://github.com/spearwolf/custom_event
// ============================================================
//
// Created at 2010/05/07
// Copyright (c) 2010-2013 Wolfger Schramm <wolfger@spearwolf.de>
//
// Permission is hereby granted, free of charge, to any person obtaining a copy of
// this software and associated documentation files (the "Software"), to deal in
// the Software without restriction, including without limitation the rights to
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
// the Software, and to permit persons to whom the Software is furnished to do so,
// subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
// IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//
!function(){function a(a,b){this.message=a||"unknown reason",this.name=b||"CustomEventError"}function b(a,b){a||(a=b?"":"/"),"/"===a[0]?(this.path=a,this.isAbsolute=!0):b?(this.node=b,this.path=a,this.isAbsolute=!1):(this.isAbsolute=!0,this.path="/"+a)}function c(a,b){for(var c;c=b.shift();){if(!(c in a))return;a=a[c]}return"function"==typeof a?a:void 0}function d(a,b){var d=typeof b,e="object"===d,g={id:j++,node:a,type:"CustomEventListener",actionType:d,isDeepListener:e,action:b};return"function"===d?g.callAction=function(a,c){a||(c?b.apply(f,c):b.apply(f))}:"object"===d?g.callAction=function(a,d){if(a){var e=c(b,a);e&&(d?e.apply(b,d):e.apply(b))}}:(i.error("unsupported listener action type:",d),g.callAction=function(){}),e?a.deepListener.push(g):a.listener.push(g),g.destroy=function(){var b=e?a.deepListener:a.listener,c=b.indexOf(g);c>=0&&b.splice(c,1);for(var d in g)g.hasOwnProperty(d)&&delete g[d]},g}function e(c,f){function g(a){return"string"==typeof a?new b(a,n):a}function i(a){for(var b,c=a.pathItems(),d=n;(b=c.shift())&&(d=d.getChild(b)););return d}function j(a){for(var b,c,d=a.pathItems(),e=n;b=d.shift();)c=e.getChild(b),c||(c=e.addChild(b)),e=c;return e}function k(a,b){var c,d,e,f=a.pathItems(),g=n;for(b&&(e=[{node:g,restPathItems:f.slice(0)}]);c=f.shift();){if(d=g.getChild(c),!d){f.splice(0,0,c);break}g=d,b&&g.listener.length>0&&e.push({node:g,restPathItems:f.length>0?f.slice(0):void 0})}return{node:g,restPathItems:f.length>0?f:void 0,visitedNodes:e}}function l(a,b,c){return function(d){return d=g(d),c&&(d=d.absolutePath()),d.isAbsolute?n.isRootNode?b(d,c):n.rootNode[a](d,c):n===d.node?b(d):d.node[a](d)}}var m={},n=function(a,b){var c=n.findOrCreate(g(a)),d=[],e={on:function(a,b){var e=c.on(a,b);return d.push(e),e},emit:c.emit,clear:function(){d.forEach(function(a){"function"==typeof a.destroy&&a.destroy()}),d=[]},group:c};return"function"==typeof b&&b.call(e,e),e};return n.type="CustomEventNode",n.nodeName=c,n.isRootNode=!f,n.parentNode=f,n.rootNode=h,n.listener=[],n.deepListener=[],n.path=function(){if(n.isRootNode)return void 0;var a="/"+n.nodeName;return f!==n.rootNode&&(a=f.path.toString()+a),new b(a,n)}(),n.addChild=function(b){if(m[b])throw new a("addChild: nodeName should be unique: "+b);var c=e(b,n);return m[b]=c,c},n.getChild=function(a){return m[a]},n.find=l("find",i),n.match=l("match",k),n.deepMatch=l("deepMatch",k,!0),n.findOrCreate=l("findOrCreate",j),n.createEventListener=function(a){return d(n,a)},n.on=function(a,b){return n.findOrCreate(a).createEventListener(b)},n.forEachListener=function(a){n.listener.forEach(a),n.deepListener.forEach(a)},n.emit=function(a){var b=null;arguments.length>1&&(b=Array.prototype.slice.call(arguments,1)),n.deepMatch(a).visitedNodes.forEach(function(a){a.node.forEachListener(function(c){c.callAction(a.restPathItems,b)})})},n}var f=this,g={VERSION:"0.8.0"};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports._e=g):"function"==typeof define&&define.amd?(define("custom_event",function(){return g}),define("custom_event/global",function(){return f._e=g,g})):f._e=g;var h,i=function(){var a="undefined"!=typeof f.console&&"function"==typeof Function&&"function"==typeof Function.prototype.bind,b=a&&"function"==typeof f.console.group,c="custom_event.js:",d={node_env:"undefined"==typeof window},e=a?function(a){return Function.prototype.bind.call(console[a],console)}:void 0,h=a?e("error"):null,i=a?e("log"):null,j=a?e("log"):null,k=b?e("group"):null,l="";return a?(d.error=function(){h.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.debug=function(){g.options.debug&&i.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.trace=function(){g.options.trace&&j.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},b?(d.debugGroup=function(){g.options.debug&&k.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.debugGroupEnd=function(){g.options.debug&&console.groupEnd()},d.traceGroup=function(){g.options.trace&&k.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.traceGroupEnd=function(){g.options.trace&&console.groupEnd()}):(d.debugGroup=function(){g.options.debug&&(i.apply(f,[l+c].concat(Array.prototype.slice.call(arguments))),l+="    ")},d.traceGroup=function(){g.options.trace&&(j.apply(f,[l+c].concat(Array.prototype.slice.call(arguments))),l+="    ")},d.traceGroupEnd=d.debugGroupEnd=function(){l=l.substr(0,l.length-4)})):d.error=d.debug=d.trace=d.traceGroup=d.traceGroupEnd=function(){},d}();a.prototype.toString=function(){return this.name+": "+this.message},b.prototype.toString=function(){return this.path},b.prototype.pathItems=function(){for(var a=this.path.split("/"),b=[],c=0;c<a.length;c++)a[c]&&b.push(a[c]);return b},b.prototype.absolutePath=function(){if(this.isAbsolute)return this;if(this.node){for(var c=[this.node.nodeName].concat(this.pathItems()),d=this.node.parentNode;d;)d.isRootNode||c.splice(0,0,d.nodeName),d=d.parentNode;return new b("/"+c.join("/"))}throw new a("NodePath.absolutePath: relative path without node")};var j=1;h=e(),g.log=i,g.rootNode=h,g.NodePath=b,g.on=h.on,g.emit=h.emit,g.group=h}();