<!DOCTYPE html>  <html> <head>   <title>custom_event.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               custom_event.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>custom_event.js</h1>

<p>Created at 2010/05/07
Copyright (c) 2010-2012 Wolfger Schramm <a href="&#x6D;&#97;&#x69;&#x6C;&#116;o:w&#x6F;&#x6C;&#102;&#103;&#101;&#114;&#64;&#115;p&#x65;&#x61;&#x72;&#x77;o&#108;&#102;&#46;&#x64;&#x65;">w&#x6F;&#x6C;&#102;&#103;&#101;&#114;&#64;&#115;p&#x65;&#x61;&#x72;&#x77;o&#108;&#102;&#46;&#x64;&#x65;</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Namespace, CommonJS and AMD Support</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Export VERSION</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">_e</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;VERSION&quot;</span><span class="o">:</span> <span class="s2">&quot;0.7.0-pre&quot;</span> <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Export the custom_event object
for <strong>Node.js</strong> and <strong>"CommonJS"</strong>, with backwards-compatibility for the old <code>require()</code> API.
If we're not in CommonJS, add <code>_e</code> to the global object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">module</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">_e</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">exports</span><span class="p">.</span><span class="nx">_e</span> <span class="o">=</span> <span class="nx">_e</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Register as a named module with AMD.</p>

<p>Module name is <code>custom_event</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">define</span><span class="p">(</span><span class="s1">&#39;custom_event&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_e</span><span class="p">;</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Module <code>custom_event/global</code> does the same plus setting <code>_e</code> into global namespace.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">define</span><span class="p">(</span><span class="s1">&#39;custom_event/global&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">_e</span> <span class="o">=</span> <span class="nx">_e</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">_e</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">_e</span> <span class="o">=</span> <span class="nx">_e</span><span class="p">;</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>logging utils</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">log</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">has_console</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">root</span><span class="p">.</span><span class="nx">console</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nb">Function</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span>
            <span class="nx">has_console_group</span> <span class="o">=</span> <span class="nx">has_console</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">root</span><span class="p">.</span><span class="nx">console</span><span class="p">.</span><span class="nx">group</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span>
            <span class="nx">logPrefix</span> <span class="o">=</span> <span class="s2">&quot;custom_event.js:&quot;</span><span class="p">,</span>
            <span class="nx">log</span> <span class="o">=</span> <span class="p">{},</span>

            <span class="nx">bindConsole</span> <span class="o">=</span> <span class="o">!</span><span class="nx">has_console</span> <span class="o">?</span> <span class="kc">undefined</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">console</span><span class="p">[</span><span class="nx">method</span><span class="p">],</span> <span class="nx">console</span><span class="p">);</span>
            <span class="p">},</span>

            <span class="nx">_error</span> <span class="o">=</span> <span class="nx">has_console</span> <span class="o">?</span> <span class="nx">bindConsole</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">_debug</span> <span class="o">=</span> <span class="nx">has_console</span> <span class="o">?</span> <span class="nx">bindConsole</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">_trace</span> <span class="o">=</span> <span class="nx">has_console</span> <span class="o">?</span> <span class="nx">bindConsole</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">_group</span> <span class="o">=</span> <span class="nx">has_console_group</span> <span class="o">?</span> <span class="nx">bindConsole</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

            <span class="nx">groupPrefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>


        <span class="k">if</span> <span class="p">(</span><span class="nx">has_console</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">_error</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="p">[</span><span class="nx">groupPrefix</span><span class="o">+</span><span class="nx">logPrefix</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
            <span class="p">};</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_debug</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="p">[</span><span class="nx">groupPrefix</span><span class="o">+</span><span class="nx">logPrefix</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
                <span class="p">}</span>
            <span class="p">};</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">trace</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">trace</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_trace</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="p">[</span><span class="nx">groupPrefix</span><span class="o">+</span><span class="nx">logPrefix</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
                <span class="p">}</span>
            <span class="p">};</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">has_console_group</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">debugGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_group</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="p">[</span><span class="nx">groupPrefix</span><span class="o">+</span><span class="nx">logPrefix</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
                    <span class="p">}</span>
                <span class="p">};</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">debugGroupEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">groupEnd</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">};</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">trace</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_group</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="p">[</span><span class="nx">groupPrefix</span><span class="o">+</span><span class="nx">logPrefix</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
                    <span class="p">}</span>
                <span class="p">};</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroupEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">trace</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">groupEnd</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">};</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">debugGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_debug</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="p">[</span><span class="nx">groupPrefix</span><span class="o">+</span><span class="nx">logPrefix</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
                        <span class="nx">groupPrefix</span> <span class="o">+=</span> <span class="s2">&quot;    &quot;</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">};</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">trace</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_trace</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="p">[</span><span class="nx">groupPrefix</span><span class="o">+</span><span class="nx">logPrefix</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
                        <span class="nx">groupPrefix</span> <span class="o">+=</span> <span class="s2">&quot;    &quot;</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">};</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroupEnd</span> <span class="o">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">debugGroupEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">groupPrefix</span> <span class="o">=</span> <span class="nx">groupPrefix</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">groupPrefix</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">4</span><span class="p">);</span>
                <span class="p">};</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span> <span class="o">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">trace</span> <span class="o">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroup</span> <span class="o">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroupEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">log</span><span class="p">;</span>
    <span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>EventNode prototype</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">EventNode</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">eType</span> <span class="o">=</span> <span class="s2">&quot;EventNode&quot;</span><span class="p">;</span>  <span class="c1">// ETYPE</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">parentNode</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">greedyChildren</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">insatiableChildren</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">rootNode</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventNode</span><span class="p">(),</span> <span class="nx">nextCallbackId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fullPathName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fullPathName</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_fullPathName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">_fullPathName</span><span class="p">()</span> <span class="o">+</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addChild</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventNode</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">greedyChar</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">insatiableSequence</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">insatiableChildren</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">splitPath</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">all_names</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="p">),</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">all_names</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">insatiableSequence</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">rest</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">all_names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">rest</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">all_names</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">all_names</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">insatiableSequence</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">rest</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">rest</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="p">)];</span>
    <span class="p">};</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matchNodes</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">split_path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">splitPath</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">split_path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">rest</span> <span class="o">=</span> <span class="nx">split_path</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">insatiableChildren</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">insatiableChildren</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">path</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">rest</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">greedyChar</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">===</span> <span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">matchNodes</span><span class="p">(</span><span class="nx">rest</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">matchNodes</span><span class="p">(</span><span class="nx">rest</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">greedyChar</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">===</span> <span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">fn</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findOrCreateNode</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">split_path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">splitPath</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">split_path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">rest</span> <span class="o">=</span> <span class="nx">split_path</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

        <span class="kd">var</span> <span class="nx">findChild</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">self</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">childName</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">child</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">childName</span> <span class="o">===</span> <span class="nx">child</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">child</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">childName</span> <span class="o">===</span> <span class="nx">child</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">child</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">})(</span><span class="k">this</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">findChild</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">rest</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">findOrCreateNode</span><span class="p">(</span><span class="nx">rest</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">eType</span><span class="o">:</span> <span class="s1">&#39;eCallback&#39;</span><span class="p">,</span>  <span class="c1">// ETYPE</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">nextCallbackId</span><span class="o">++</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="nx">fn</span><span class="o">:</span> <span class="nx">callback</span><span class="p">,</span>
            <span class="nx">once</span><span class="o">:</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">once</span><span class="p">,</span>
            <span class="nx">binding</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">binding</span><span class="p">,</span>
            <span class="nx">paused</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">EventNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroyCallbacks</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">updated_callbacks</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">skip</span><span class="p">,</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">skip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">ids</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">ids</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">skip</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="o">++</span><span class="nx">count</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">skip</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">updated_callbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">updated_callbacks</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2><em>internal</em> api</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">registerEventListener</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">opts</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">topic</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">rootNode</span><span class="p">.</span><span class="nx">findOrCreateNode</span><span class="p">(</span><span class="nx">topic</span><span class="p">).</span><span class="nx">addCallback</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">eType</span><span class="o">:</span> <span class="s1">&#39;EventListener&#39;</span><span class="p">,</span>  <span class="c1">// ETYPE</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">_e</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">eType</span><span class="p">;</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">;</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">;</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="nx">emit</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="p">[</span><span class="nx">listener</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span> <span class="p">},</span>
            <span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pause</span><span class="p">)</span> <span class="p">{</span> 
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pause</span> <span class="o">===</span> <span class="s1">&#39;boolean&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">listener</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="nx">pause</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">paused</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">registerEventListenerOnce</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">opts</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">registerEventListener</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">registerIdleEventListener</span><span class="p">(</span><span class="nx">eventPath</span><span class="p">,</span> <span class="nx">idleTimeout</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">idleTimer</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">currentTimeout</span> <span class="o">=</span> <span class="nx">idleTimeout</span><span class="p">;</span>

        <span class="kd">function</span> <span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">idleTimer</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">idleTimer</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">idleTimer</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">registerTimer</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">currentTimeout</span> <span class="o">=</span> <span class="nx">timeout</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">clearTimer</span><span class="p">();</span>
            <span class="nx">idleTimer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callIdleFunc</span><span class="p">,</span> <span class="nx">currentTimeout</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">api</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">eType</span><span class="o">:</span> <span class="s2">&quot;IdleEventListener&quot;</span><span class="p">,</span>  <span class="c1">// ETYPE</span>

            <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">clearTimer</span><span class="p">();</span>
                <span class="nx">listener</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="p">},</span>

            <span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pause_</span><span class="p">,</span> <span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pause_</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">paused</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">paused</span> <span class="o">=</span> <span class="nx">pause_</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">pause_</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">clearTimer</span><span class="p">();</span>
                    <span class="nx">listener</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">idleTimer</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">registerTimer</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
                        <span class="nx">listener</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>

            <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">timeout</span><span class="p">);</span> <span class="p">},</span>
            <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="p">},</span>

            <span class="nx">touch</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">emit</span><span class="p">();</span> <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">function</span> <span class="nx">callIdleFunc</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">idleTimer</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="nx">listener</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
            <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">api</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">api</span><span class="p">.</span><span class="nx">pause</span><span class="p">())</span> <span class="p">{</span>
                <span class="nx">registerTimer</span><span class="p">();</span>
                <span class="nx">listener</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">listener</span> <span class="o">=</span> <span class="nx">registerEventListener</span><span class="p">(</span><span class="nx">eventPath</span><span class="p">,</span> <span class="nx">registerTimer</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">registerTimer</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">api</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createEmitStackTrace</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">_emitStackTrace</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_e</span><span class="p">.</span><span class="nx">_emitStackTrace</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">currentLevel</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">topicPath</span><span class="o">:</span> <span class="p">[]</span> <span class="p">};</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="o">++</span><span class="nx">_e</span><span class="p">.</span><span class="nx">_emitStackTrace</span><span class="p">.</span><span class="nx">currentLevel</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">_emitStackTrace</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">clearEmitStackTrace</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">--</span><span class="nx">_e</span><span class="p">.</span><span class="nx">_emitStackTrace</span><span class="p">.</span><span class="nx">currentLevel</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">_emitStackTrace</span><span class="p">.</span><span class="nx">currentLevel</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_e</span><span class="p">.</span><span class="nx">_emitStackTrace</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">currentLevel</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">topicPath</span><span class="o">:</span> <span class="p">[]</span> <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">emitEvent</span><span class="p">(</span><span class="nx">options_</span><span class="p">,</span> <span class="nx">topic_</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">results</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">result_fn</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span>
            <span class="nx">options</span> <span class="o">=</span> <span class="nx">options_</span><span class="p">,</span>
            <span class="nx">topic</span> <span class="o">=</span> <span class="nx">topic_</span><span class="p">,</span>
            <span class="nx">has_options</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">has_options</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">topic</span> <span class="o">=</span> <span class="nx">options_</span><span class="p">;</span>
            <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">collect</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result_fn</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">collect</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="p">(</span><span class="nx">has_options</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">collect</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">===</span> <span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result_fn</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroup</span><span class="p">(</span><span class="s2">&quot;_e.emit -&gt;&quot;</span><span class="p">,</span> <span class="nx">topic</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">stacktrace</span> <span class="o">=</span> <span class="nx">createEmitStackTrace</span><span class="p">();</span>

        <span class="nx">rootNode</span><span class="p">.</span><span class="nx">matchNodes</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">restPath</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">destroy_callback_ids</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">call_count</span><span class="p">,</span>

                    <span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                            <span class="nx">destroy_callback_ids</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
                        <span class="p">};</span>
                    <span class="p">},</span>

                    <span class="nx">pause</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                            <span class="nx">callback</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="p">};</span>
                    <span class="p">},</span>

                    <span class="nx">result</span><span class="p">,</span>
                    <span class="nx">context</span><span class="p">,</span>
                    <span class="nx">callback</span><span class="p">,</span>
                    <span class="nx">args_</span><span class="p">;</span>

                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">callback</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">log</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;_e.on -&gt; (paused)&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">callback</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">stacktrace</span><span class="p">.</span><span class="nx">topicPath</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">stacktrace</span><span class="p">.</span><span class="nx">topicPath</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

                        <span class="nx">context</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">binding</span> <span class="o">||</span> <span class="p">{};</span>
                        <span class="nx">context</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">topic</span><span class="p">;</span>
                        <span class="nx">context</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">context</span><span class="p">.</span><span class="nx">eType</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">context</span><span class="p">.</span><span class="nx">eType</span> <span class="o">=</span> <span class="s1">&#39;EventListener&#39;</span><span class="p">;</span>  <span class="c1">// ???</span>
                        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>don't overwrite _e.Module's pause()</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">context</span><span class="p">.</span><span class="nx">pause</span> <span class="o">!==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">context</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="nx">pause</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="nx">args_</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">restPath</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">context</span><span class="p">.</span><span class="nx">pathArgs</span> <span class="o">=</span> <span class="nx">restPath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="p">);</span>
                            <span class="nx">args_</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">pathArgs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="nx">log</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;_e.on -&gt;&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">callback</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="s2">&quot;args=&quot;</span><span class="p">,</span> <span class="nx">args_</span><span class="p">);</span>

                        <span class="nx">result</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args_</span><span class="p">);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">once</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">destroy_callback_ids</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">result</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                        <span class="p">}</span>
                        
                        <span class="nx">stacktrace</span><span class="p">.</span><span class="nx">topicPath</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;_e.on -&gt; (skipped/recursion)&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">callback</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="nx">node</span><span class="p">.</span><span class="nx">destroyCallbacks</span><span class="p">(</span><span class="nx">destroy_callback_ids</span><span class="p">);</span>

            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="nx">clearEmitStackTrace</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">result_fn</span> <span class="o">&amp;&amp;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">result_fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">results</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">log</span><span class="p">.</span><span class="nx">traceGroupEnd</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">pathOrId</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span> <span class="o">||</span> <span class="nx">rootNode</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pathOrId</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">destroyCallbacks</span><span class="p">([</span><span class="nx">pathOrId</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">pathOrId</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">pathOrId</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">greedyChildren</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">insatiableChildren</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">pathOrId</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">insatiableChildren</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">connectEventListener</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
            <span class="nx">topic</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">_e</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_e</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="p">[</span><span class="nx">listener</span><span class="p">[</span><span class="nx">j</span><span class="p">]].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">args</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createModule</span><span class="p">(</span><span class="nx">rootPath</span><span class="p">,</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rootPath</span> <span class="o">=</span> <span class="nx">rootPath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">sub_modules</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">annotation</span><span class="p">;</span>

        <span class="nx">log</span><span class="p">.</span><span class="nx">debugGroup</span><span class="p">(</span><span class="s2">&quot;_e.Module -&gt;&quot;</span><span class="p">,</span> <span class="nx">rootPath</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;_init&quot;</span> <span class="k">in</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;constructor&quot;</span><span class="p">,</span> <span class="nx">rootPath</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">insatiableSequence</span><span class="p">);</span>
            <span class="nx">listener</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="nx">rootPath</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">insatiableSequence</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">_init</span><span class="p">,</span> <span class="p">{</span> <span class="nx">binding</span><span class="o">:</span> <span class="nx">module</span> <span class="p">}));</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">module</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">annotation</span> <span class="o">=</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^(on|module) (.+)$/</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">annotation</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;on&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">module</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">prop</span> <span class="o">!==</span> <span class="s1">&#39;_init&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">annotation</span> <span class="o">=</span> <span class="nx">annotation</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="nx">rootPath</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                                <span class="nx">listener</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">rootPath</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">module</span><span class="p">[</span><span class="nx">prop</span><span class="p">],</span> <span class="p">{</span> <span class="nx">binding</span><span class="o">:</span> <span class="nx">module</span> <span class="p">}));</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="nx">rootPath</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">insatiableSequence</span><span class="p">);</span>
                                <span class="nx">listener</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_e</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">rootPath</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">insatiableSequence</span><span class="p">,</span> <span class="nx">module</span><span class="p">[</span><span class="nx">prop</span><span class="p">],</span> <span class="p">{</span> <span class="nx">binding</span><span class="o">:</span> <span class="nx">module</span> <span class="p">}));</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;module&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">module</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">sub_modules</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">createModule</span><span class="p">(</span><span class="nx">rootPath</span><span class="o">+</span><span class="nx">_e</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pathSeparator</span><span class="o">+</span><span class="nx">annotation</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">module</span><span class="p">[</span><span class="nx">prop</span><span class="p">]));</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">debugGroupEnd</span><span class="p">();</span>

        <span class="nx">module</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">listener</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sub_modules</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">sub_modules</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">var</span> <span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">module</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pause</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pause</span> <span class="o">===</span> <span class="s1">&#39;boolean&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">paused</span> <span class="o">=</span> <span class="nx">pause</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">listener</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pause</span><span class="p">(</span><span class="nx">pause</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sub_modules</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">sub_modules</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pause</span><span class="p">(</span><span class="nx">pause</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">paused</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">module</span><span class="p">.</span><span class="nx">eType</span> <span class="o">=</span> <span class="s2">&quot;eModule&quot;</span><span class="p">;</span>  <span class="c1">// ETYPE</span>

        <span class="k">return</span> <span class="nx">module</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h1>custom_event api</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>_e.on( <em>topic</em> , <em>callback</em> )</h3>

<p>Subscribe to a topic.</p>

<p>@see test/<em>e.on</em>spec.js</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="nx">registerEventListener</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>_e.idle( <em>topic</em> , <em>idleTimeout</em> , <em>callback</em> )</h3>

<p>Register an "idle" EventListener.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">idle</span> <span class="o">=</span> <span class="nx">registerIdleEventListener</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>_e.once( <em>topic</em> , <em>callback</em> )</h3>

<p>Subscribe a "one-time" callback to a topic.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="nx">registerEventListenerOnce</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>TODO require
     - think about persistence here..
_e.require [topic-a, topic-b, ..], function(topicA, topicB, ..)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>_e.emit( <em>topic</em> , [ <em>arg</em>, .. ] )</h3>

<p>Publish an event to a specific topic.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">emit</span> <span class="o">=</span> <span class="nx">emitEvent</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>_e.collect( <em>topic</em> , [ <em>arg</em>, .. ], <em>callback</em> )</h3>

<p>Publish a topic and collect all results (if any).</p>

<p>@see test/<em>e.collect</em>spec.js</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">collect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">emitEvent</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="p">[{</span> <span class="nx">collect</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>TODO _e.get "topic", function() {}
     should we persist listeners here?</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Connect multiple topics together.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="nx">connectEventListener</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Destroy a subscriber (EventListener) by id.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="nx">destroy</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>XXX @obsolete
module API</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">Module</span> <span class="o">=</span> <span class="nx">createModule</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>_e.options</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <ul>
<li><strong>pathSeparator:</strong> char for path separation</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">pathSeparator</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <ul>
<li><strong>greedyChar:</strong> char for wildcard topics</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">greedyChar</span><span class="o">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <ul>
<li><strong>insatiableSequence:</strong> char sequence for double-wildcard topics</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">insatiableSequence</span><span class="o">:</span> <span class="s1">&#39;**&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <ul>
<li><strong>trace:</strong> enable <em>trace</em> log</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">trace</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <ul>
<li><strong>debug:</strong> enable <em>debug</em> log</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">debug</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h3>misc exports</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p><em>rootNode</em> for deep insight.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">_rootNode</span> <span class="o">=</span> <span class="nx">rootNode</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>logger.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_e</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">log</span><span class="p">;</span>
<span class="p">})();</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 