// ============================================================
// custom_event.js -- https://github.com/spearwolf/custom_event
// ============================================================
//
// Created at 2010/05/07
// Copyright (c) 2010-2015 Wolfger Schramm <wolfger@spearwolf.de>
//
// Permission is hereby granted, free of charge, to any person obtaining a copy of
// this software and associated documentation files (the "Software"), to deal in
// the Software without restriction, including without limitation the rights to
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
// the Software, and to permit persons to whom the Software is furnished to do so,
// subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
// IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//
!function(a){"use strict";var b;"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b={},define(function(){return b})):b=("undefined"!=typeof window?window:a)._e={}:b=exports,function(a){function b(b){i(this,"name",b),this.pause=!1,a.eventize(this)}function c(a,e){this.pause=!1,j(this,{object:a,isDestroyed:!1,isTopic:a instanceof b}),a instanceof d&&(e="pipe"),"function"==typeof a?j(this,{isFunction:!0,signal:function(a,b,c){this.object.apply(c,b)},equals:function(a){return a===this||a.object===this.object&&a.isFunction===!0}}):(i(this,"isFunction",!1),e="string"==typeof e?e:"emit","emit"===e||"on"===e?j(this,{property:"emit",signal:function(a,b){var c=this.object[this.property];"function"==typeof c&&c.apply(this.object,[a].concat(b))}}):"pipe"===e?j(this,{property:"pipe",signal:function(a,b){this.object.pipe(a,b)}}):a instanceof c?j(this,{property:"signal",signal:function(a,b){var c=this.object[this.property];"function"==typeof c&&c.call(this.object,[a].concat(b))}}):j(this,{property:e,signal:function(a,b){var c=this.object[this.property];"function"==typeof c&&c.apply(this.object,b)}}),this.equals=function(a){return a===this||a.object===this.object&&a.property===this.property})}function d(a,b,c){i(this,"name",a),this.receiver=c,this.sender=b,this.pause=!1}function e(a){this.name="CustomEventError",this.message=a}function f(a,b){if(a&&b&&b.receiver)for(var c=a.length;c--;)if(b.name===a[c].name&&b.receiver.equals(a[c].receiver))return c;return-1}function g(a,b){b&&b._e&&-1===f(b._e.connections,a)&&b._e.connections.push(a)}function h(a,b){if(b&&b._e&&Array.isArray(b._e.connections)){var c=f(b._e.connections,a);c>=0&&b._e.connections.splice(c,1)}}function i(a,b,c){Object.defineProperty(a,b,{value:c,configurable:!0,enumerable:!0})}function j(a,b){var c,d=Object.keys(b);for(c=d.length;c--;)i(a,d[c],b[d[c]])}function k(a,b,c){Object.defineProperty(a,b,{value:c,configurable:!0})}i(a,"VERSION","0.9.0"),a.eventize=function(b,f){return"object"==typeof b._e?b:(k(b,"_e",Object.create(null)),b._e.connections=[],b.on=function(a,b){return"string"==typeof a&&a.length>0&&"undefined"!=typeof b?new d(a,this,b):void 0},b.emit=function(){var a,b,c=this._e.connections.length,d=arguments[0],e=Array.prototype.slice.call(arguments,1);if("string"==typeof d)for(b=0;c>b;b++)a=this._e.connections[b],a&&a.name===d&&a.pipe(d,e,f||this)},b.connect=function(b,c){if(this===c)throw new e("can't connect object with oneself!");return a.eventize(c),this.on(b,c)},b instanceof c?(k(b,"_signal",b.signal),i(b,"signal",function(a,b,c){this._signal(a,b,c),this.emit("signal",this,a,b,c)})):b instanceof d&&(k(b,"_pipe",b.pipe),i(b,"pipe",function(a,b){this._pipe(a,b),this._pause||this.emit("pipe",this,a,b)})),b)},a.slot=function(b,d,e){var f=new c(b,d);return e?a.eventize(f):f},k(a,"_topics",Object.create(null)),a.topic=function(c){null==c&&(c="_e");var d=a._topics[c];return"object"!=typeof d&&(d=new b(c),a._topics[c]=d),d},a.emit=function(){var b=a.topic();b.emit.apply(b,arguments)},a.on=function(){var b=a.topic();b.on.apply(b,arguments)},a.connect=function(b,c,d){if(2===arguments.length){var f=a.topic();return f.connect(b,c)}if(c===d)throw new e("can't connect object with oneself!");return a.eventize(c),c.on(b,d)},Object.defineProperties(b.prototype,{pause:{enumerable:!0,get:function(){return this._pause},set:function(a){i(this,"pause",!!a)}}}),c.prototype.destroy=function(){this.pause=!0,j(this,{isDestroyed:!0,signal:function(){},equals:function(){return!1}}),delete this.object,delete this._signal},Object.defineProperties(c.prototype,{pause:{enumerable:!0,get:function(){return this.isTopic?this._pause||this.object&&this.object.pause:this._pause},set:function(a){k(this,"_pause",!!a)}}}),d.prototype.pipe=function(a,b,c){this.pause||null==this._receiver||(this._receiver.isDestroyed?this.receiver=null:this._receiver.signal(a,b,c))},d.prototype.eventize=function(){return a.eventize(this)},Object.defineProperties(d.prototype,{receiver:{enumerable:!0,get:function(){return this._receiver},set:function(a){if(k(this,"_receiver",null==a?null:a instanceof c?a:new c(a)),null!=this._receiver&&this._receiver.isDestroyed)throw new e("can't create a connection to destroyed slot (receiver)!")}},sender:{enumerable:!0,get:function(){return this._sender},set:function(b){var c=this._sender;k(this,"_sender",b),null!=b?(a.eventize(b),c!==b&&(null!=c&&h(this,c),g(this,b))):null!=c&&h(this,c)}},pause:{enumerable:!0,get:function(){return this._pause},set:function(a){k(this,"_pause",!!a)}}}),e.prototype=new Error,e.prototype.constructor=e}(b)}(this);